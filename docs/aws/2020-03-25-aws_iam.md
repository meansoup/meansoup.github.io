---
layout: post
title: IAM
tag:
  - AWS
parent: aws
permalink: /docs/aws/iam
---

## IAM(Identity and Access Management)
IAM은 계정들의 리소스들에 대한 접근 권한을 관리하기 위해 제공하는 AWS의 서비스이다.  
사용자와 사용자에 대한 권한(어느 리소스에 어느 정도 접근 가능한지)을 부여할 수 있다.  
보안, 권한 관리 등의 목적으로 root 계정보다 IAM 사용자 등록하는 것을 강하게 권장한다.  
- IAM을 사용하지 않고 root account로 진행해도 되지만 root account는 모든 권한을 가지고 있어 제어를 할 수 없는 문제가 있음.  

IAM은 global service로 모든 리전에서 동일하게 사용할 수 있다.

## 공동 책임 모델
AWS에서 보안에 대한 책임은 사용자와 AWS측에서 공동으로 갖도록 한다.  

**사용자 책임**:  
AWS를 사용하여 구현하는 것과 AWS에 연결하는 애플리케이션의 보안.

**AWS 책임**:  
제공하는 시설, 네트워크, 하드웨어, 소프트웨어에 대한 보안과 보호.

## IAM 항목
**Users**:  
사용자가 누구인지(인증)와 어떤 권한을 가지고 있는지를 설정한다.  
제거하기 전까지 영구적인 key 값을 갖도록 함.  

**Policies**:  
정책으로 권한을 부여한다.  
예를 들면 `EC2를 사용할 수 있다`와 같은 정책을 명시.  
  - json 형식으로 명시. ([AWS 예시](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/access_policies.html) 참고.)  

**Groups**:  
여러 사용자를 그룹화하여 권한을 부여.  

**Roles**:  
역할에 권한을 부여하고, 사용자나 서비스에 역할을 주어 권한을 부여.  
사용자에게 일시적으로 권한을 부여할 수 있음.  
접근하기 위해 특정 기간에만 사용할 수 있는 임시 key를 사용. 만료될 경우 재 요청해야 함.  
권한을 일시적으로 주려면 키가 노출될 수 있는데 역할을 사용하여 이를 보호할 수도 있음.  

## IAM 권장 디자인
root 계정은 사용하지 않고,  
관리자 계정을 만들고 root 계정은 사용하지 않는다.  
관리자 계정에서 다른 계정, 그룹을 만들어서 관리한다.  

보안을 위해 최소한의 권한만을 부여하며  
그룹에 정책을 적용한다.

## IAM 권한 유형
1. 자격 증명 기반 권한  
   IAM 사용자와 연결되어 사용자가 접근할 수 있는 것을 명시  
2. 리소스 기반 권한  
   리소스(서비스)에 연결되어 해당 리소스에 접근할 수 있는 사람을 명시  
   지원하는 서비스가 S3, SQS, SNS 뿐.  

두 권한을 모두 사용할 수 있기 때문에 권한에 문제가 있다면 서비스 권한을 확인해봐야 한다.

## IAM 정책 유형
IAM 정책은 관리형/인라인 정책으로 나뉜다.  

**관리형 정책**:  
재사용성, 중앙 집중식 변경 관리, 버전과 롤백, 다른 사용자에게 권한 관리를 위임과 같은 여러 기능을 제공한다.  
관리형 정책은 여러 사용자, 그룹, 역할에 연결될 수 있는 독립형 정책이다.

**인라인 정책**:  
인라인 정책은 사용자, 그룹, 역할의 엔터티(보안 주체)에 포함되어 있는 정책이다.  
여러 엔터티가 같은 정책을 사용할 수 있지만 정책을 공유하지는 않는다.  

기본적으로 모든 권한은 없는 상태이며, 정책에서 명시적으로 허용하는 경우 허용되나, 명시적 거부와 허용이 둘다 있는 경우는 거부한다.  

## AWS 자격 증명 설정
CLI 같은 경우 access_key와 secret_access_key를 넘겨주어서 자격을 증명한다.  
key를 가지고 있는 자격 증명 파일로 자격 증명을 지정할 수 있다. (`.aws/credentials`)  
- 프로젝트 외부에 저장되어 재사용이 가능하고 보안 실수를 줄일 수 있다.  

자격증명 우선순위는 아래와 같다.  
> 코드에 지정 됨 > 환경 변수 > 자격 증명 파일 > EC2 인스턴스 역할

## 자격 증명 요청에 서명
자격 증명 요청에 서명을 할 수 있다.
요청자의 신원 확인, 데이터 보호를 위해 SDK에서 설정한 자격 증명으로 모든 요청에 자동으로 서명을 할 수 있다.